{"ast":null,"code":"import _regeneratorRuntime from\"/root/react-apps/back_end/be-youtiful/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/root/react-apps/back_end/be-youtiful/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/root/react-apps/back_end/be-youtiful/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer}from\"react\";import axios from'axios';import AuthContext from'./authContext';import authReducer from'./authReducer';import setAuthToken from'../../utils/setAuthToken';import{REGISTER_SUCCESS,REGISTER_FAIL,CLIENT_LOADED,AUTH_ERROR,LOGIN_SUCCESS,LOGIN_FAIL,LOGOUT,CLEAR_ERRORS}from'../types';var AuthState=function AuthState(props){var initialState={token:localStorage.getItem('token'),isAuthenticated:null,client:null,loading:true,error:null};var _useReducer=useReducer(authReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];// Load client\nvar loadClient=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(localStorage.token){setAuthToken(localStorage.token);}_context.prev=1;_context.next=4;return axios.get('/api/auth');case 4:res=_context.sent;dispatch({type:CLIENT_LOADED,payload:res.data});_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);dispatch({type:AUTH_ERROR});case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function loadClient(){return _ref.apply(this,arguments);};}();// Register Client\nvar register=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(formData){var config,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:config={headers:{'Content-Type':'application/json'}};_context2.prev=1;_context2.next=4;return axios.post('api/clients',formData,config);case 4:res=_context2.sent;dispatch({type:REGISTER_SUCCESS,payload:res.data});loadClient();_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);dispatch({type:REGISTER_FAIL,payload:_context2.t0.response.data.msg});//console.log(err.response.data.msg)\ncase 12:case\"end\":return _context2.stop();}}},_callee2,null,[[1,9]]);}));return function register(_x){return _ref2.apply(this,arguments);};}();// Login Client\nvar login=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(formData){var config,res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:config={headers:{'Content-Type':'application/json'}};_context3.prev=1;_context3.next=4;return axios.post('api/auth',formData,config);case 4:res=_context3.sent;dispatch({type:LOGIN_SUCCESS,payload:res.data});loadClient();_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](1);dispatch({type:LOGIN_FAIL,payload:_context3.t0.response.data.msg});case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[1,9]]);}));return function login(_x2){return _ref3.apply(this,arguments);};}();//Logout\nvar logout=function logout(){dispatch({type:LOGOUT});};// Clear errors\nvar clearErrors=function clearErrors(){dispatch({type:CLEAR_ERRORS});};return React.createElement(AuthContext.Provider,{value:{token:state.token,isAuthenticated:state.isAuthenticated,client:state.client,laoding:state.loading,error:state.error,register:register,loadClient:loadClient,login:login,logout:logout,clearErrors:clearErrors}},props.children);};export default AuthState;","map":{"version":3,"sources":["/root/react-apps/back_end/be-youtiful/src/context/auth/AuthState.js"],"names":["React","useReducer","axios","AuthContext","authReducer","setAuthToken","REGISTER_SUCCESS","REGISTER_FAIL","CLIENT_LOADED","AUTH_ERROR","LOGIN_SUCCESS","LOGIN_FAIL","LOGOUT","CLEAR_ERRORS","AuthState","props","initialState","token","localStorage","getItem","isAuthenticated","client","loading","error","state","dispatch","loadClient","get","res","type","payload","data","register","formData","config","headers","post","response","msg","login","logout","clearErrors","laoding","children"],"mappings":"qWAAA,MAAOA,CAAAA,KAAP,EAAgBC,UAAhB,KAAkC,OAAlC,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,WAAP,KAAwB,eAAxB,CACA,MAAOC,CAAAA,WAAP,KAAwB,eAAxB,CACA,MAAOC,CAAAA,YAAP,KAAyB,0BAAzB,CACA,OAEAC,gBAFA,CAGAC,aAHA,CAIAC,aAJA,CAKAC,UALA,CAMAC,aANA,CAOAC,UAPA,CAQAC,MARA,CASAC,YATA,KAUO,UAVP,CAYA,GAAMC,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,CAAAC,KAAK,CAAG,CACtB,GAAMC,CAAAA,YAAY,CAAE,CAChBC,KAAK,CAAEC,YAAY,CAACC,OAAb,CAAqB,OAArB,CADS,CAEhBC,eAAe,CAAE,IAFD,CAGhBC,MAAM,CAAE,IAHQ,CAIhBC,OAAO,CAAE,IAJO,CAKhBC,KAAK,CAAE,IALS,CAApB,CADsB,gBASItB,UAAU,CAACG,WAAD,CAAcY,YAAd,CATd,4CASfQ,KATe,iBASRC,QATQ,iBAY1B;AACA,GAAMC,CAAAA,UAAU,0FAAG,2IACf,GAAGR,YAAY,CAACD,KAAhB,CAAsB,CAClBZ,YAAY,CAACa,YAAY,CAACD,KAAd,CAAZ,CACH,CAHc,sCAKOf,CAAAA,KAAK,CAACyB,GAAN,CAAU,WAAV,CALP,QAKLC,GALK,eAMXH,QAAQ,CAAC,CACLI,IAAI,CAAErB,aADD,CAELsB,OAAO,CAAEF,GAAG,CAACG,IAFR,CAAD,CAAR,CANW,+EAWXN,QAAQ,CAAC,CACLI,IAAI,CAACpB,UADA,CAAD,CAAR,CAXW,oEAAH,kBAAViB,CAAAA,UAAU,0CAAhB,CAmBA;AACA,GAAMM,CAAAA,QAAQ,2FAAG,kBAAMC,QAAN,qIACPC,MADO,CACE,CACXC,OAAO,CAAE,CACL,eAAgB,kBADX,CADE,CADF,yCASSjC,CAAAA,KAAK,CAACkC,IAAN,CAAW,aAAX,CAAyBH,QAAzB,CAAmCC,MAAnC,CATT,QASHN,GATG,gBAWTH,QAAQ,CAAC,CACLI,IAAI,CAAEvB,gBADD,CAELwB,OAAO,CAAEF,GAAG,CAACG,IAFR,CAAD,CAAR,CAKAL,UAAU,GAhBD,mFAkBJD,QAAQ,CAAC,CACVI,IAAI,CAAEtB,aADI,CAEVuB,OAAO,CAAE,aAAIO,QAAJ,CAAaN,IAAb,CAAkBO,GAFjB,CAAD,CAAR,CAKL;AAvBS,sEAAH,kBAARN,CAAAA,QAAQ,6CAAd,CA4BA;AACA,GAAMO,CAAAA,KAAK,2FAAG,kBAAMN,QAAN,qIACJC,MADI,CACK,CACXC,OAAO,CAAE,CACL,eAAgB,kBADX,CADE,CADL,yCASYjC,CAAAA,KAAK,CAACkC,IAAN,CAAW,UAAX,CAAsBH,QAAtB,CAAgCC,MAAhC,CATZ,QASAN,GATA,gBAWNH,QAAQ,CAAC,CACLI,IAAI,CAAEnB,aADD,CAELoB,OAAO,CAAEF,GAAG,CAACG,IAFR,CAAD,CAAR,CAKAL,UAAU,GAhBJ,mFAkBDD,QAAQ,CAAC,CACVI,IAAI,CAAElB,UADI,CAEVmB,OAAO,CAAE,aAAIO,QAAJ,CAAaN,IAAb,CAAkBO,GAFjB,CAAD,CAAR,CAlBC,sEAAH,kBAALC,CAAAA,KAAK,8CAAX,CA2BA;AACA,GAAMC,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,EAAM,CACjBf,QAAQ,CAAC,CACLI,IAAI,CAACjB,MADA,CAAD,CAAR,CAGH,CAJD,CAMA;AACA,GAAM6B,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAAM,CACtBhB,QAAQ,CAAC,CACLI,IAAI,CAAChB,YADA,CAAD,CAAR,CAGH,CAJD,CASI,MACI,qBAAC,WAAD,CAAa,QAAb,EACI,KAAK,CAAE,CACHI,KAAK,CAAEO,KAAK,CAACP,KADV,CAEHG,eAAe,CAAEI,KAAK,CAACJ,eAFpB,CAGHC,MAAM,CAAEG,KAAK,CAACH,MAHX,CAIHqB,OAAO,CAAElB,KAAK,CAACF,OAJZ,CAKHC,KAAK,CAAEC,KAAK,CAACD,KALV,CAMHS,QAAQ,CAARA,QANG,CAOHN,UAAU,CAAVA,UAPG,CAQHa,KAAK,CAALA,KARG,CASHC,MAAM,CAANA,MATG,CAUHC,WAAW,CAAXA,WAVG,CADX,EAeK1B,KAAK,CAAC4B,QAfX,CADJ,CAqBH,CA/HD,CAkIA,cAAe7B,CAAAA,SAAf","sourcesContent":["import React, { useReducer } from \"react\";\nimport axios from 'axios';\nimport AuthContext from './authContext';\nimport authReducer from './authReducer';\nimport setAuthToken from '../../utils/setAuthToken'\nimport {\n    \nREGISTER_SUCCESS,\nREGISTER_FAIL,\nCLIENT_LOADED,\nAUTH_ERROR,\nLOGIN_SUCCESS,\nLOGIN_FAIL,\nLOGOUT,\nCLEAR_ERRORS\n} from '../types'\n \nconst AuthState = props =>{\n    const initialState ={\n        token: localStorage.getItem('token'),\n        isAuthenticated: null,\n        client: null,\n        loading: true,\n        error: null\n    };\n\n    const [state, dispatch] = useReducer(authReducer, initialState);\n\n\n// Load client\nconst loadClient = async() => {\n    if(localStorage.token){\n        setAuthToken(localStorage.token);\n    }\n    try {\n        const res = await axios.get('/api/auth');\n        dispatch({\n            type: CLIENT_LOADED,\n            payload: res.data\n        })\n    } catch (error) {\n        dispatch({\n            type:AUTH_ERROR\n        })\n    }\n\n    \n}\n\n// Register Client\nconst register = async formData =>{\n    const config = {\n        headers: {\n            'Content-Type': 'application/json'\n        }\n        \n    }\n\n    try {\n        const res = await axios.post('api/clients',formData ,config);\n\n        dispatch({\n            type: REGISTER_SUCCESS,\n            payload: res.data\n        });\n\n        loadClient()\n    } catch (err) {\n             dispatch({\n            type: REGISTER_FAIL,\n            payload: err.response.data.msg\n            \n        }) \n        //console.log(err.response.data.msg)\n    }\n}\n\n\n// Login Client\nconst login = async(formData) => {\n    const config = {\n        headers: {\n            'Content-Type': 'application/json'\n        }\n        \n    }\n\n    try {\n        const res = await axios.post('api/auth',formData ,config);\n\n        dispatch({\n            type: LOGIN_SUCCESS,\n            payload: res.data\n        });\n\n        loadClient()\n    } catch (err) {\n             dispatch({\n            type: LOGIN_FAIL,\n            payload: err.response.data.msg\n            \n        })\n        \n    }\n}\n\n//Logout\nconst logout = () => {\n    dispatch({\n        type:LOGOUT\n    })\n}\n\n// Clear errors\nconst clearErrors = () => {\n    dispatch({\n        type:CLEAR_ERRORS\n    });\n}\n\n\n\n    \n    return(\n        <AuthContext.Provider\n            value={{\n                token: state.token,\n                isAuthenticated: state.isAuthenticated,\n                client: state.client,\n                laoding: state.loading,\n                error: state.error,\n                register,\n                loadClient,\n                login,\n                logout,\n                clearErrors\n\n            }}\n        >\n            {props.children}\n        </AuthContext.Provider>\n    )\n\n\n}\n\n\nexport default AuthState;"]},"metadata":{},"sourceType":"module"}